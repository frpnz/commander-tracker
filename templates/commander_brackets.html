{% extends "base.html" %}
{% block content %}
<h1>Gestione Bracket Commander</h1>

<p class="muted">
  Qui puoi modificare il bracket associato a un commander e applicarlo automaticamente a <b>tutte</b> le sue istanze presenti nel database.
</p>

{% if ok == "1" %}
  <div class="card" style="border-color:#b7e0b7; background:#f2fff2;">
    Aggiornamento completato.
  </div>
{% elif ok == "0" %}
  <div class="error">Commander non valido.</div>
{% endif %}

<div class="card">
  <form method="post" action="/commander_brackets/set" style="display:flex; gap:10px; align-items:end; flex-wrap:wrap;">
    <div>
      <label>Commander</label><br>
      <input name="commander" list="commander_list" placeholder="Es: Atraxa, Praetors' Voice" style="min-width:280px;" required>
      <datalist id="commander_list">
        {% for row in summary %}
          <option value="{{ row.commander }}"></option>
        {% endfor %}
      </datalist>
    </div>

    <div>
      <label>Nuovo bracket (1-5 o n/a)</label><br>
      <input name="bracket_value" placeholder="n/a" style="width:120px;">
    </div>

    <div>
      <button type="submit">Applica a tutte le istanze</button>
    </div>
  </form>
</div>

<h2>Panoramica</h2>
<table>
  <thead>
    <tr>
      <th>Commander</th>
      <th>Totale</th>
      <th>Bracket (1..5)</th>
      <th>n/a</th>
      <th>Bracket “attuale”</th>
      <th>Azione rapida</th>
    </tr>
  </thead>
  <tbody>
    {% for row in summary %}
      <tr>
        <td><b>{{ row.commander }}</b></td>
        <td>{{ row.total }}</td>
        <td class="muted">
          1: {{ row.counts[1] }} ·
          2: {{ row.counts[2] }} ·
          3: {{ row.counts[3] }} ·
          4: {{ row.counts[4] }} ·
          5: {{ row.counts[5] }}
        </td>
        <td>{{ row.counts["n/a"] }}</td>
        <td>{{ row.current_bracket if row.current_bracket is not none else "n/a" }}</td>
        <td>
          <form method="post" action="/commander_brackets/set" style="display:flex; gap:6px; align-items:center;">
            <input type="hidden" name="commander" value="{{ row.commander }}">
            <input name="bracket_value" placeholder="n/a" style="width:72px;">
            <button type="submit">Set</button>
          </form>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
