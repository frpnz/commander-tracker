{% extends "base.html" %}
{% block content %}
<h1>Aggiungi partita</h1>

{% if error %}
  <div class="card" style="border:1px solid #c33;">
    <b>Errore:</b> {{ error }}
  </div>
{% endif %}

<form method="post" action="/add" class="card">
  <div class="row" style="gap:12px; flex-wrap:wrap; align-items:end;">
    <div style="min-width:220px;">
      <label>Player</label><br>
      <select id="playerSelect" style="width:100%;">
        <option value="">— seleziona —</option>
        {% for p in players %}
          <option value="{{ p }}">{{ p }}</option>
        {% endfor %}
      </select>
    </div>

    <div style="min-width:260px;">
      <label>Commander</label><br>
      <select id="commanderSelect" style="width:100%;">
        <option value="">— seleziona —</option>
        {% for c in commanders %}
          <option value="{{ c }}">{{ c }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <button type="button" id="addLineBtn">Inserisci riga</button>
    </div>
  </div>

  <div style="margin-top:12px;">
    <label>Entries (una riga per player)</label><br>
    <textarea id="entriesText" name="entries_text" rows="8" style="width:100%;" required
      placeholder="Fra-Magda
Matti-Flubs
..."></textarea>
    <p class="muted" style="margin-top:6px;">
      Formato: <code>Player - Commander</code> (una riga per player)
    </p>
  </div>

  <div class="row" style="gap:12px; flex-wrap:wrap; margin-top:12px;">
    <div style="min-width:220px;">
      <label>Winner</label><br>
      <input name="winner_player" placeholder="" style="width:100%;">
    </div>

    <div style="flex:1; min-width:260px;">
      <label>Note</label><br>
      <input name="notes" placeholder="(opzionale)" style="width:100%;">
    </div>
  </div>

  <div style="margin-top:12px;">
    <button type="submit">Salva</button>
  </div>
</form>

<!-- Opzionale: lista “cliccabile” rapida -->
<div class="row" style="gap:12px; margin-top:16px; flex-wrap:wrap;">
  <div class="card" style="flex:1; min-width:280px;">
    <h3>Player nel DB</h3>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      {% for p in players %}
        <button type="button" class="muted" onclick="setPlayer('{{ p|e }}')">{{ p }}</button>
      {% endfor %}
    </div>
  </div>

  <div class="card" style="flex:1; min-width:280px;">
    <h3>Commander nel DB</h3>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      {% for c in commanders %}
        <button type="button" class="muted" onclick="setCommander('{{ c|e }}')">{{ c }}</button>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  const playerSelect = document.getElementById("playerSelect");
  const commanderSelect = document.getElementById("commanderSelect");
  const entriesText = document.getElementById("entriesText");

  document.getElementById("addLineBtn").addEventListener("click", () => {
    const p = (playerSelect.value || "").trim();
    const c = (commanderSelect.value || "").trim();
    if (!p || !c) return;

    const line = `${p} - ${c}`;
    const current = entriesText.value.trim();

    // evita duplicati identici
    const lines = current ? current.split("\n").map(s => s.trim()) : [];
    if (!lines.includes(line)) lines.push(line);

    entriesText.value = lines.join("\n") + "\n";
  });

  function setPlayer(p) { playerSelect.value = p; }
  function setCommander(c) { commanderSelect.value = c; }
</script>

{% endblock %}
